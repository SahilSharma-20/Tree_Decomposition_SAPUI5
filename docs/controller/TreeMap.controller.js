sap.ui.define(["sap/ui/core/mvc/Controller","tmt/treemap/model/Data"],function(t,e){"use strict";return t.extend("tmt.treemap.controller.TreeMap",{onAfterRendering:function(){const t=document.getElementById("d3DecompTree");if(!t){console.error("Decomposition Tree container not found.");return}t.innerHTML="";const r=e.getTreeData();const n=t.clientWidth||960;const a=t.clientHeight||600;const l={top:20,right:120,bottom:20,left:120};const o=d3.select(t).append("svg").attr("width",n).attr("height",a).call(d3.zoom().scaleExtent([.5,3]).on("zoom",i)).append("g").attr("transform",`translate(${l.left},${l.top})`);function i(t){o.attr("transform",t.transform)}let s=0,c=750,d;const f=d3.tree().size([a-l.top-l.bottom,n-l.left-l.right]);d=d3.hierarchy(r,t=>t.children);d.x0=(a-l.top-l.bottom)/2;d.y0=0;d.children.forEach(p);h(d);function p(t){if(t.children){t._children=t.children;t._children.forEach(p);t.children=null}}function h(t){let e=f(d);let r=e.descendants(),i=e.descendants().slice(1);r.forEach(t=>t.y=t.depth*180);let p=o.selectAll("g.node").data(r,t=>t.id||(t.id=++s));let x=p.enter().append("g").attr("class","node").attr("transform",e=>`translate(${t.y0},${t.x0})`).call(d3.drag().on("start",k).on("drag",v).on("end",D)).on("click",(t,e)=>{if(e.children){e._children=e.children;e.children=null}else{e.children=e._children;e._children=null}h(e)});x.append("circle").attr("class","node").attr("r",1e-6).style("fill",t=>t._children?"#ffb347":"#d94f70").style("cursor","pointer");x.append("text").attr("dy",".35em").attr("x",t=>t.children||t._children?-13:13).attr("text-anchor",t=>t.children||t._children?"end":"start").text(t=>t.data.name).style("user-select","none");x.append("text").attr("class","plus-button").attr("x",20).attr("y",-10).attr("font-size","16px").attr("cursor","pointer").text("+").on("click",(t,e)=>{t.stopPropagation();E(e,d3.select(t.currentTarget.parentNode))});let y=x.merge(p);y.transition().duration(c).attr("transform",t=>`translate(${t.y},${t.x})`);y.select("circle.node").attr("r",8).style("fill",t=>t._children?"#ffb347":"#d94f70").attr("cursor","pointer");let u=p.exit().transition().duration(c).attr("transform",e=>`translate(${t.y},${t.x})`).remove();u.select("circle").attr("r",1e-6);u.select("text").style("fill-opacity",1e-6);let m=o.selectAll("path.link").data(i,t=>t.id);let $=m.enter().insert("path","g").attr("class","link").attr("d",e=>{let r={x:t.x0,y:t.y0};return b(r,r)}).style("fill","none").style("stroke","#ccc").style("stroke-width","2px");let g=$.merge(m);g.transition().duration(c).attr("d",t=>b(t,t.parent));let _=m.exit().transition().duration(c).attr("d",e=>{let r={x:t.x,y:t.y};return b(r,r)}).remove();r.forEach(t=>{t.x0=t.x;t.y0=t.y});function b(t,e){return`M ${t.y} ${t.x}\n                            C ${(t.y+e.y)/2} ${t.x},\n                              ${(t.y+e.y)/2} ${e.x},\n                              ${e.y} ${e.x}`}function k(t,e){d3.select(this).raise().classed("active",true)}function v(t,e){e.x=t.y;e.y=t.x;d3.select(this).attr("transform",`translate(${e.y},${e.x})`);h(e)}function D(t,e){d3.select(this).classed("active",false)}function E(t,e){const r=e.select("g.detail-card");if(!r.empty()){r.remove();e.select(".plus-button").text("+");return}e.select(".plus-button").text("âˆ’");const o=220,i=90;let s=30;let c=20;if(t.y+o+l.left>n){s=-o-20}if(t.x+i+l.top>a){c=-(i+10)}const d=e.append("g").attr("class","detail-card").attr("transform",`translate(${s},${c})`);d.append("rect").attr("width",o).attr("height",i).attr("rx",6).attr("ry",6).style("fill","#f9f9f9").style("stroke","#999").style("stroke-width","1.5px").style("filter","drop-shadow(2px 2px 4px #aaa)");const f=t.data.details||{};const p=[`Plant: ${f.plant||"-"}`,`Material Name: ${f.materialName||"-"}`,`Material Code: ${f.materialCode||"-"}`,`Consignment Date: ${f.consignmentDate||"-"}`];d.selectAll("text").data(p).enter().append("text").attr("x",10).attr("y",(t,e)=>20+e*18).text(t=>t).attr("font-size","12px").attr("fill","#333").style("font-family","Arial, sans-serif")}}}})});
//# sourceMappingURL=TreeMap.controller.js.map